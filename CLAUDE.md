# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ“š Development Guidelines Reference

### ãƒ¡ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- **çµ±åˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**: https://gist.githubusercontent.com/zio3/20d171adf94bd3311498c5af428da13c/raw/claude-guidelines.md
Curlã‚’ã¤ã‹ã£ã¦èª­ã¿è¾¼ã‚“ã§ãã ã•ã„

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

Smart Filesystem MCPã¯ã€LLMã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œã‚’æä¾›ã™ã‚‹**ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**ãªModel Context Protocol (MCP)ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚ä¸»è¦ãªè¨­è¨ˆåŸå‰‡ã¯ã€å¿…è¦ãªæ“ä½œæ•°ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ã§ã€ã»ã¨ã‚“ã©ã®ã‚¿ã‚¹ã‚¯ã¯å˜ä¸€ã®`read_file`ã‚³ãƒãƒ³ãƒ‰ã§å®Œäº†ã—ã¾ã™ã€‚

## ä¸»è¦ãªè¨­è¨ˆå“²å­¦: ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ

1. **åŸºæœ¬æ“ä½œã¯é€šå¸¸é€šã‚Šå‹•ä½œ**: `read_file`ã¯å®‰å…¨ãªå ´åˆã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç›´æ¥è¿”ã—ã¾ã™
2. **ã‚¹ãƒãƒ¼ãƒˆãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åˆ¶é™ã‚’è¶…ãˆãŸå ´åˆã®ã¿è©³ç´°æƒ…å ±ã‚’æä¾›
3. **ãƒ¯ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼/åˆ†æ/èª­ã¿å–ã‚Šã®ãƒã‚§ãƒ¼ãƒ³ã¯ä¸è¦
4. **æ®µéšçš„ãªæƒ…å ±é–‹ç¤º**: å¿…è¦ãªå ´åˆã®ã¿è©³ç´°æƒ…å ±ã¨ä»£æ›¿æ¡ˆã‚’æä¾›
5. **ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆ**: ã™ã¹ã¦ã®pathãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯çµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆ

### ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆåŸå‰‡

**çµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆ** - ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ“ä½œã¯çµ¶å¯¾ãƒ‘ã‚¹ã‚’è¦æ±‚ã—ã¾ã™:
- ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ`./file.txt`, `../parent/`ï¼‰ã¯å—ã‘ä»˜ã‘ã¾ã›ã‚“
- èµ·å‹•ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`process.cwd()`ï¼‰ã¸ã®ä¾å­˜ã‚’æ’é™¤
- å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®Œå…¨ã«è‡ªå·±è¨˜è¿°çš„ã§äºˆæ¸¬å¯èƒ½
- LLMåˆ©ç”¨ã«ãŠã„ã¦å¤–éƒ¨çŠ¶æ…‹ã¸ã®ä¾å­˜ã‚’å›é¿

## ä¸»è¦ãªé–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰
npm run build

# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run dev

# å‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
npm run typecheck

# ãƒªãƒ³ãƒˆã®å®Ÿè¡Œ
npm run lint

# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
npm run test:tools    # ãƒ„ãƒ¼ãƒ«ã®ã¿ãƒ†ã‚¹ãƒˆ
npm run test:core     # ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿ãƒ†ã‚¹ãƒˆ
npm run test:api      # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã¿ãƒ†ã‚¹ãƒˆ
npm run test:unit     # çµ±åˆãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:coverage

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:watch

# å˜ä¸€ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
npm test src/tools/read-file.test.ts

# CLIãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰
npm run cli list <directory>    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ
npm run cli read <file>         # ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šã®ãƒ†ã‚¹ãƒˆ
npm run cli search [directory]  # æ¤œç´¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ

# APIã‚µãƒ¼ãƒãƒ¼ã‚³ãƒãƒ³ãƒ‰
npm run api:dev    # é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§APIã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œ
npm run api:build  # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã«ãƒ“ãƒ«ãƒ‰
npm run api:start  # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ä¸‰å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

```
MCP Server Layer (src/index.ts)
â”œâ”€â”€ Tool Layer (src/tools/*.ts) - å„ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
â”œâ”€â”€ Core Layer (src/core/*.ts) - å…±é€šæ©Ÿèƒ½ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯  
â””â”€â”€ Utils Layer (src/utils/*.ts) - çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

### ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **UnifiedErrorHandler** (`src/utils/unified-error-handler.ts`) - ğŸ†• é‡è¦
   - **å…¨ãƒ„ãƒ¼ãƒ«çµ±ä¸€ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¨ãƒ©ãƒ¼ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
   - æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æä¾›
   - MCPä¾‹å¤–æ’²æ»…ã®ä¸­æ ¸

2. **SafetyController** (`src/core/safety-controller.ts`)
   - å®Ÿè¡Œå‰ã«æ“ä½œã‚’æ¤œè¨¼
   - ã‚µã‚¤ã‚ºã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®åˆ¶é™ã‚’å¼·åˆ¶
   - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰: `validateFileAccess()`, `enforceTimeout()`, `validateDirectoryAccess()`

3. **SecurityControllerV2** (`src/core/security-controller-v2.ts`)
   - è¨±å¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç®¡ç†
   - ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã®é˜²æ­¢
   - ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼

4. **FileAnalyzer** (`src/core/file-analyzer.ts`)
   - ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ—ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’åˆ†æ
   - ä¸»ã«ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ä½¿ç”¨
   - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰: `analyzeFile()`, `detectFileType()`

5. **SearchEngine** (`src/core/search-engine.ts`)
   - ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¤œç´¢æ“ä½œã‚’å‡¦ç†
   - å®‰å…¨æ€§åˆ¶å¾¡ä»˜ãã®æ­£è¦è¡¨ç¾ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
   - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰: `searchByFilePattern()`, `searchByContent()`

### MCPã‚µãƒ¼ãƒãƒ¼è¨­è¨ˆï¼ˆé‡è¦ãªå¤‰æ›´ï¼‰

**MCPã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼è¨­è¨ˆ** - `src/index.ts`
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’**é™¤å»**
- ãƒ„ãƒ¼ãƒ«é–¢æ•°ã«ç›´æ¥å§”è­²
- çµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ã‚’ãã®ã¾ã¾è¿”å´
- MCPä¾‹å¤–ã‚’æŠ•ã’ãªã„è¨­è¨ˆ

### ãƒ„ãƒ¼ãƒ«å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

å…¨ãƒ„ãƒ¼ãƒ«ãŒä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ã¾ã™:

```typescript
// çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³
export async function toolName(params: Params, safety: SafetyController): Promise<Success | UnifiedError> {
  // 1. å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆçµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ã§è¿”å´ï¼‰
  // 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
  // 3. æ“ä½œå®Ÿè¡Œ
  // 4. ä¾‹å¤–å‡¦ç†ï¼ˆçµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ã«å¤‰æ›ï¼‰
}
```

### ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

#### read_file - ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ„ãƒ¼ãƒ«ï¼ˆéƒ¨åˆ†èª­ã¿è¾¼ã¿å¯¾å¿œï¼‰

```typescript
// æˆåŠŸã‚±ãƒ¼ã‚¹ - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç›´æ¥è¿”ã™ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
{
  "tool": "read_file",
  "arguments": { "path": "./small-file.txt" }
}
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹: { 
//   "success": true, 
//   "content": "ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹...",
//   "file_info": {
//     "total_lines": 50,
//     "returned_lines": 50,
//     "line_range": { "start": 1, "end": 50 }
//   }
// }

// éƒ¨åˆ†èª­ã¿è¾¼ã¿ - æŒ‡å®šç¯„å›²ã®ã¿è¿”ã™
{
  "tool": "read_file",
  "arguments": { "path": "./large-file.log", "start_line": 1000, "end_line": 1500 }
}
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹: { 
//   "success": true, 
//   "content": "1000è¡Œç›®ã‹ã‚‰1500è¡Œç›®ã®å†…å®¹...",
//   "file_info": {
//     "total_lines": 10000,
//     "returned_lines": 501,
//     "line_range": { "start": 1000, "end": 1500 }
//   }
// }

// åˆ¶é™è¶…é - éƒ¨åˆ†èª­ã¿è¾¼ã¿ã‚’ææ¡ˆ
{
  "tool": "read_file", 
  "arguments": { "path": "./large-file.log" }
}
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {
//   "success": false,
//   "error": {
//     "code": "file_too_large",
//     "message": "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆ2.0 MBï¼‰ãŒåˆ¶é™ï¼ˆ20 KBï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™",
//     "details": {
//       "file_info": {
//         "total_lines": 10000,
//         "size_bytes": 2097152,
//         "estimated_tokens": 524288
//       },
//       "alternatives": {
//         "partial_read_available": true,
//         "suggestions": [
//           "Use start_line and end_line parameters to read specific sections",
//           "Example: start_line=1, end_line=500 (reads first 500 lines)",
//           "Example: start_line=5000, end_line=5500 (reads middle section)"
//         ]
//       }
//     }
//   }
// }
```


#### search_content - å¼·åŠ›ãªæ¤œç´¢ï¼ˆæ”¹å–„ç‰ˆï¼‰

```typescript
// åå‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ï¼ˆfile_patternå˜ä½“ãŒæ­£å¸¸å‹•ä½œï¼‰
{
  "tool": "search_content",
  "arguments": { 
    "file_pattern": ".*\\.test\\.ts$",
    "directory": "/absolute/path/to/src"
  }
}

// æ‹¡å¼µå­ã®ã¿ã§æ¤œç´¢ï¼ˆæ–°æ©Ÿèƒ½ï¼‰
{
  "tool": "search_content",
  "arguments": {
    "extensions": [".ts", ".js"],
    "directory": "/absolute/path/to/project"
  }
}

// æ­£è¦è¡¨ç¾ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ¤œç´¢
{
  "tool": "search_content",
  "arguments": {
    "content_pattern": "TODO|FIXME|HACK",
    "directory": "/absolute/path/to/project",
    "extensions": [".js", ".ts"]
  }
}

// è¤‡åˆæ¤œç´¢
{
  "tool": "search_content",
  "arguments": {
    "file_pattern": "config",
    "content_pattern": "database.*url",
    "directory": "/absolute/path/to/project",
    "case_sensitive": true
  }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé™¤å¤–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œï¼‰
{
  "tool": "search_content",
  "arguments": {
    "content_pattern": "export",
    "directory": "/absolute/path/to/project"
    // node_modules, .git, dist, build, out, .next, coverage, __tests__, testç­‰ã‚’é™¤å¤–
  }
}

// æœ€å°é™ã®é™¤å¤–ã®ã¿ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã«è¿‘ã„ï¼‰
{
  "tool": "search_content",
  "arguments": {
    "content_pattern": "export",
    "directory": "/absolute/path/to/project",
    "userDefaultExcludeDirs": false
    // node_modules, .gitã®ã¿é™¤å¤–
  }
}
```

#### get_default_exclude_dirs - é™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª

```typescript
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
{
  "tool": "get_default_exclude_dirs"
}
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {
//   "success": true,
//   "excludeDirs": ["node_modules", ".git", "dist", ...],
//   "type": "user_default",
//   "description": "é–‹ç™ºè€…å‘ã‘ã«æœ€é©åŒ–ã•ã‚ŒãŸé™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§"
// }

// æœ€å°é™é™¤å¤–ã®ç¢ºèª
{
  "tool": "get_default_exclude_dirs",
  "arguments": { "userDefaultExcludeDirs": false }
}
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {
//   "success": true,
//   "excludeDirs": ["node_modules", ".git"],
//   "type": "minimal",
//   "description": "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šå¿…è¦ãªæœ€å°é™ã®é™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª"
// }
```

### ä¸»è¦ãªå®‰å…¨åˆ¶é™

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 20kb (è¶…éã—ãŸå ´åˆã¯éƒ¨åˆ†èª­ã¿è¾¼ã¿ã‚’ææ¡ˆ)
- éƒ¨åˆ†èª­ã¿è¾¼ã¿: start_line/end_lineã§ç¯„å›²æŒ‡å®šå¯èƒ½ï¼ˆ1ãƒ™ãƒ¼ã‚¹ã€ä¸¡ç«¯å«ã‚€ï¼‰
- è¡Œç•ªå·ã¯1ã‹ã‚‰é–‹å§‹ã€æŒ‡å®šç¯„å›²ã®ä¸¡ç«¯ã‚’å«ã‚€
- æ¤œç´¢ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 30ç§’
- æœ€å¤§æ¤œç´¢çµæœ: 500ãƒ•ã‚¡ã‚¤ãƒ«
- æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³é•·: 1000æ–‡å­—
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚­ãƒ£ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1000ãƒ•ã‚¡ã‚¤ãƒ«
- ãƒˆãƒ¼ã‚¯ãƒ³è­¦å‘Š: 50,000ãƒˆãƒ¼ã‚¯ãƒ³
- æ“ä½œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5-30ç§’

## ä¸»è¦ãªå‹å®šç¾©

### ã‚³ã‚¢ã‚¿ã‚¤ãƒ— (`src/core/types.ts`)

- `FileInfo`: ã‚µã‚¤ã‚ºã¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±
- `FileAnalysis`: ã‚¿ã‚¤ãƒ—æ¤œå‡ºã‚’å«ã‚€æ‹¡å¼µåˆ†æ
- `OperationResult<T>`: status: 'success' | 'error' | 'warning' ã‚’æŒã¤æ¨™æº–çµæœãƒ©ãƒƒãƒ‘ãƒ¼
- `SafetyValidation`: å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ã®çµæœ
- å„MCPãƒ„ãƒ¼ãƒ«ç”¨ã®ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ—

### é‡è¦ãªå‹ã®å¤‰æ›´

- `OperationResult`ã¯`success`ãƒ–ãƒ¼ãƒ«å€¤ã§ã¯ãªã`status`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã¯`size`ã¨`timestamps.modified`ã‚’æŒã¤`FileInfo`ã‚’ä½¿ç”¨
- æ¤œç´¢çµæœã«ã¯ISOæ–‡å­—åˆ—ã¨ã—ã¦`file_size_bytes`ã¨`last_modified`ãŒå«ã¾ã‚Œã‚‹

## é‡è¦ãªé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆå¿…é ˆï¼‰

**å…¨ã¦ã®ãƒ„ãƒ¼ãƒ«ãŒçµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ã‚’ä½¿ç”¨ã—ã¾ã™** - `src/utils/unified-error-handler.ts`

```typescript
// âœ… æ­£ã—ã„çµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼
{
  "success": false,
  "error": {
    "code": "missing_path",
    "message": "ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“",
    "details": {
      "operation": "read_file",
      "path": "/invalid/path"
    },
    "suggestions": [
      "æœ‰åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
    ]
  }
}
```

**é‡è¦ãªå®Ÿè£…è¦å‰‡:**
1. **MCPä¾‹å¤–ã‚’æŠ•ã’ãªã„** - å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã¯çµ±ä¸€å½¢å¼ã§è¿”å´
2. **ç©ºãƒ‘ã‚¹æ¤œè¨¼** - å…¨ãƒ„ãƒ¼ãƒ«ã§`validatePath()`ä½¿ç”¨å¿…é ˆ
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦–** - `createUnifiedError()`ãŒãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º
4. **æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** - å…¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§æä¾›

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
import { createUnifiedError, ErrorCodes, validatePath } from '../utils/unified-error-handler.js';

export async function myTool(params: MyParams): Promise<MySuccess | UnifiedError> {
  // 1. ãƒ‘ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const pathValidation = validatePath(params.path);
  if (!pathValidation.valid) {
    return createUnifiedError(
      ErrorCodes.MISSING_PATH,
      'my_tool',
      {},
      pathValidation.error?.includes('empty') ? 'ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“' : 'ä¸æ­£ãªãƒ‘ã‚¹å½¢å¼ã§ã™'
    );
  }
  
  // 2. çµ¶å¯¾ãƒ‘ã‚¹ãƒã‚§ãƒƒã‚¯
  if (!path.isAbsolute(params.path)) {
    return createUnifiedError(
      ErrorCodes.PATH_NOT_ABSOLUTE,
      'my_tool',
      { path: params.path }
    );
  }
  
  try {
    // æ“ä½œã‚’å®Ÿè¡Œ
    return { success: true, result: data };
  } catch (error) {
    // 3. ä¾‹å¤–ã‚’çµ±ä¸€ã‚¨ãƒ©ãƒ¼ã«å¤‰æ›
    return createUnifiedErrorFromException(error, 'my_tool', params.path);
  }
}
```

### æ–°æ©Ÿèƒ½ã®è¿½åŠ 

1. **ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆå“²å­¦ã‚’ç¶­æŒ**
2. **çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¿…é ˆ**
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§çµæœã‚’ç›´æ¥è¿”ã™**
4. **åˆ¶é™ã«é”ã—ãŸå ´åˆã®ã¿è¤‡é›‘ã•ã‚’è¿½åŠ **
5. **çµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆã®ç¶­æŒ**

### ãƒ†ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```bash
# æˆåŠŸã™ã‚‹èª­ã¿å–ã‚Šã®ãƒ†ã‚¹ãƒˆ
npm run cli read package.json

# å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ
npm run cli read large-file.log

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆçµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆï¼‰
npm run cli list /absolute/path/to/src --hidden --sort size

# æ¤œç´¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆï¼ˆçµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆï¼‰
npm run cli search -c "TODO" /absolute/path/to/src

# ç©ºãƒ‘ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆçµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ç¢ºèªï¼‰
npm run cli read ""

# çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
npm test -- --testNamePattern="unified"
```

## ä¸€èˆ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

1. å¸¸ã«æœ€åˆã«`read_file`ã‚’è©¦ã™
2. ã‚µã‚¤ã‚ºè¶…éã®å ´åˆã€éƒ¨åˆ†èª­ã¿è¾¼ã¿ã‚’ä½¿ç”¨:
   - `start_line`ã¨`end_line`ã§ç¯„å›²æŒ‡å®šï¼ˆ1ãƒ™ãƒ¼ã‚¹ã€ä¸¡ç«¯å«ã‚€ï¼‰
   - `search_content`ã§å¯¾è±¡è¡Œç•ªå·ã‚’ç‰¹å®šå¾Œã€éƒ¨åˆ†èª­ã¿è¾¼ã¿
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯å¸¸ã«`file_info`ãŒå«ã¾ã‚Œã€ç·è¡Œæ•°ã‚„è¿”å´è¡Œæ•°ã‚’ç¢ºèªå¯èƒ½
3. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹:
   - å…ˆé ­500è¡Œ: `{ "path": "/file.txt", "end_line": 500 }`
   - ç‰¹å®šç¯„å›²: `{ "path": "/file.txt", "start_line": 1000, "end_line": 1500 }`
   - æœ«å°¾ã‹ã‚‰: `{ "path": "/file.txt", "start_line": 9500 }` (æœ€å¾Œã¾ã§èª­ã¿è¾¼ã¿)
   - 1è¡Œã ã‘: `{ "path": "/file.txt", "start_line": 100, "end_line": 100 }`

### ã‚³ãƒ¼ãƒ‰ã®æ¤œç´¢ï¼ˆçµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆï¼‰

1. ç‰¹å®šã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«`search_content`ã‚’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å…±ã«ä½¿ç”¨
2. **å¿…ãšçµ¶å¯¾ãƒ‘ã‚¹ã‚’æŒ‡å®š** - ç›¸å¯¾ãƒ‘ã‚¹ã¯æ‹’å¦ã•ã‚Œã‚‹
3. æ­£ç¢ºãªæ¤œç´¢ã®ãŸã‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã‚‹
4. æ­£è¦è¡¨ç¾ãƒ•ãƒ©ã‚°ã‚’é©åˆ‡ã«ä½¿ç”¨ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã®åŒºåˆ¥ã€å˜èªå…¨ä½“ï¼‰

### ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›† - ã‚¹ãƒãƒ¼ãƒˆç·¨é›†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæˆ¦ç•¥: ã‚·ãƒ³ãƒ—ãƒ«ã‹ã‚‰å§‹ã‚ã‚‹**

```typescript
// âœ… æ¨å¥¨: ã‚·ãƒ³ãƒ—ãƒ«ãªæ–‡å­—åˆ—ç½®æ›ï¼ˆçµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆï¼‰
{
  "tool": "edit_file",
  "arguments": {
    "path": "/absolute/path/to/config.js",
    "edits": [
      {"oldText": "const PORT = 3000", "newText": "const PORT = 8080"}
    ]
  }
}

// ğŸ¯ å¿…è¦ãªå ´åˆ: ãƒ‘ã‚¿ãƒ¼ãƒ³ç”¨ã®æ­£è¦è¡¨ç¾ï¼ˆçµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆï¼‰
{
  "tool": "edit_file", 
  "arguments": {
    "path": "/absolute/path/to/utils.js",
    "edits": [
      {
        "type": "regex",
        "pattern": "function\\s+temp\\d+",
        "replacement": "function temp",
        "flags": "g"
      }
    ]
  }
}
```

**æ±ºå®šãƒãƒˆãƒªãƒƒã‚¯ã‚¹:**

| ã‚·ãƒŠãƒªã‚ª | æ–¹æ³• | ä¾‹ |
|----------|--------|---------|
| è¨­å®šå€¤ã®å¤‰æ›´ | ã‚·ãƒ³ãƒ—ãƒ« | `"PORT = 3000"` â†’ `"PORT = 8080"` |
| ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã®æ›´æ–° | ã‚·ãƒ³ãƒ—ãƒ« | `"./old-path"` â†’ `"./new-path"` |
| è¤‡æ•°ã®ç•ªå·ä»˜ãå¤‰æ•° | æ­£è¦è¡¨ç¾ | `user1, user2, user3` â†’ `user` |
| ç©ºç™½ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | æ­£è¦è¡¨ç¾ | è¤‡æ•°ã‚¹ãƒšãƒ¼ã‚¹ â†’ å˜ä¸€ã‚¹ãƒšãƒ¼ã‚¹ |
| ã‚³ãƒ¡ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®å¤‰æ›´ | æ­£è¦è¡¨ç¾ | `//` â†’ `/* */` |

**ä»¥ä¸‹ã®å ´åˆã¯å¸¸ã«dry_runã‚’ä½¿ç”¨:**
- æ­£è¦è¡¨ç¾æ“ä½œ
- è¤‡æ•°ã®åŒæ™‚ç·¨é›†
- 100è¡Œã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**
1. ã‚·ãƒ³ãƒ—ãƒ«ãªç½®æ›ã‹ã‚‰å§‹ã‚ã‚‹ï¼ˆ90%ã®ã‚±ãƒ¼ã‚¹ã§ååˆ†ï¼‰
2. ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹å ´åˆã®ã¿æ­£è¦è¡¨ç¾ã‚’æ¤œè¨
3. é©ç”¨å‰ã«`dry_run: true`ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
4. diffå‡ºåŠ›ã¨ãƒãƒƒãƒæ•°ã‚’ç¢ºèª
5. æº€è¶³ã—ãŸã‚‰dry_runãªã—ã§ç·¨é›†ã‚’é©ç”¨

### ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†

- `read_file`ã¯ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡ºã—ã¦å ±å‘Š
- ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æƒ…å ±ã‚’æä¾›
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã«é©ã—ãŸãƒ„ãƒ¼ãƒ«ã‚’ææ¡ˆ

## APIã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ãƒ–ãƒ©ã‚¦ã‚¶/CURLãƒ†ã‚¹ãƒˆç”¨ã®Expressãƒ™ãƒ¼ã‚¹ã®REST APIã‚µãƒ¼ãƒãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™:

```bash
# APIã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run api:dev

# SwaggerUIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
http://localhost:3000/api-docs

# APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯RESTfulãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ã¾ã™:
GET    /api/files/content?path=...
POST   /api/files/content
PUT    /api/files/edit
DELETE /api/files?path=...
GET    /api/directories/list?path=...
POST   /api/search/content
```

## é‡è¦ãªæ³¨æ„äº‹é …ãƒ»åˆ¶é™

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ€è¡“ä»•æ§˜
- **ESãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¿…é ˆ** - `"type": "module"`ã‚’ä½¿ç”¨
- **`.js`æ‹¡å¼µå­å¿…é ˆ** - ã™ã¹ã¦ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«`.js`æ‹¡å¼µå­ã‚’å«ã‚ã‚‹
- **çµ¶å¯¾ãƒ‘ã‚¹å¿…é ˆ** - å…¨ã¦ã®æ“ä½œã§çµ¶å¯¾ãƒ‘ã‚¹ã‚’è¦æ±‚ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆï¼‰
- **TypeScript** - å‹å®‰å…¨æ€§ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º

### çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åˆ¶é™
- **MCPä¾‹å¤–ç¦æ­¢** - å…¨ãƒ„ãƒ¼ãƒ«ã§çµ±ä¸€ã‚¨ãƒ©ãƒ¼å½¢å¼ã‚’ä½¿ç”¨
- **æ—¥æœ¬èªå¿…é ˆ** - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§æä¾›
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦–** - æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©ã‚’é˜²æ­¢

### é‹ç”¨åˆ¶é™
- **ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ** - è¤‡é›‘ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“
- **è¨±å¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ¶é™** - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ãŒå¼·åˆ¶
- **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ** - Windows/Unixä¸¡å¯¾å¿œ